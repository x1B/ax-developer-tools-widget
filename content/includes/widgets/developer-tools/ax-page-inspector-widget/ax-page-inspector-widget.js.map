{"version":3,"sources":["ax-page-inspector-widget.jsx"],"names":[],"mappings":"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","file":"ax-page-inspector-widget.js","sourcesContent":["import React from 'react';\nimport patterns from 'laxar-patterns';\n\nimport wireflow from 'wireflow';\n\nimport { types, graph, layout, filterFromSelection } from './graph-helpers';\n\nconst {\n  selection: { SelectionStore },\n  history: { HistoryStore },\n  layout: { LayoutStore },\n  graph: { GraphStore },\n  settings: {\n    actions: { ChangeMode },\n    model: { Settings, READ_ONLY, READ_WRITE },\n    SettingsStore\n  },\n  Dispatcher,\n  components: { Graph }\n} = wireflow;\n\n\nfunction create( context, eventBus, reactRender ) {\n\n   let domAvailable = false;\n   let resourceAvailable = false;\n   let visible = false;\n   let showIrrelevantWidgets = false;\n   let publishedSelection = null;\n\n   patterns.resources.handlerFor( context )\n      .registerResourceFromFeature( 'pageInfo', {\n         onUpdateReplace: () => {\n            resourceAvailable = true;\n            update();\n         }\n      } );\n\n\n   const publishFilter = patterns.resources.replacePublisherForFeature( context, 'filter', {\n      isOptional: true\n   } );\n\n   eventBus.subscribe( `didChangeAreaVisibility.${context.widget.area}`, event => {\n      if( !visible && event.visible ) {\n         visible = true;\n         update();\n      }\n   } );\n\n   function replaceFilter( selection, graphModel ) {\n      const resource = context.features.filter.resource;\n      if( !resource || selection === publishedSelection ) {\n         return;\n      }\n      publishedSelection = selection;\n      publishFilter( filterFromSelection( selection, graphModel ) );\n   }\n\n   function toggleIrrelevantWidgets() {\n      showIrrelevantWidgets = !showIrrelevantWidgets;\n      update();\n   }\n\n   function renderEmpty() {\n      reactRender( <h3>Waiting for data</h3> );\n   }\n\n   let dispatcher;\n   function update() {\n      if( !visible || !domAvailable || !resourceAvailable ) {\n         return;\n      }\n\n      const pageInfo = context.resources.pageInfo;\n      const pageGraph = graph( pageInfo, showIrrelevantWidgets );\n\n      const pageTypes = types();\n      dispatcher = new Dispatcher( render );\n      new HistoryStore( dispatcher );\n      const graphStore = new GraphStore( dispatcher, pageGraph, pageTypes );\n      const layoutStore = new LayoutStore( dispatcher, graphStore );\n      const settingsStore = new SettingsStore( dispatcher, Settings({ mode: READ_ONLY }) );\n      const selectionStore = new SelectionStore( dispatcher, layoutStore, graphStore );\n\n      function render() {\n         replaceFilter( selectionStore.selection, graphStore.graph );\n\n         reactRender(\n            <div className='page-inspector-row form-inline'>\n               <div className='row text-right'>\n                  <button className='btn btn-link'\n                          type='button'\n                          onClick={toggleIrrelevantWidgets}\n                     ><i className={'fa fa-toggle-' + ( showIrrelevantWidgets ? 'on' : 'off' ) }\n                     ></i> &quot;Silent&quot; Widgets</button>\n               </div>\n               <Graph className='nbe-theme-fusebox-app'\n                      types={graphStore.types}\n                      model={graphStore.graph}\n                      layout={layoutStore.layout}\n                      measurements={layoutStore.measurements}\n                      settings={settingsStore.settings}\n                      selection={selectionStore.selection}\n                      eventHandler={dispatcher.dispatch} />\n            </div>\n         );\n      }\n   }\n\n   return { onDomAvailable: () => {\n      domAvailable = true;\n      update();\n   } };\n}\n\nexport default {\n   name: 'ax-page-inspector-widget',\n   injections: [ 'axContext', 'axEventBus', 'axReactRender' ],\n   create\n};\n"]}