{"version":3,"sources":["ax-page-inspector-widget.jsx"],"names":[],"mappings":"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","file":"ax-page-inspector-widget.js","sourcesContent":["import React from 'react';\nimport patterns from 'laxar-patterns';\n\nimport wireflow from 'wireflow';\n\nimport { types, graph, layout } from './graph-helpers';\n\nconst {\n  selection: {\n    SelectionStore\n  },\n  history: {\n    actions: { CreateCheckpoint },\n    HistoryStore\n  },\n  layout: {\n     actions: { AutoLayout },\n     LayoutStore\n  },\n  graph: {\n    GraphStore\n  },\n  settings: {\n    actions: { ChangeMode },\n    model: { Settings, READ_ONLY, READ_WRITE },\n    SettingsStore\n  },\n  Dispatcher,\n  components: { Graph }\n} = wireflow;\n\nfunction create( context, eventBus, reactRender ) {\n\n   var domAvailable = false;\n   var resourceAvailable = false;\n   var visible = false;\n\n   patterns.resources.handlerFor( context )\n      .registerResourceFromFeature( 'pageInfo', {\n         onUpdateReplace: () => {\n            console.log( 'resource changed' )\n            resourceAvailable = true;\n            update();\n         }\n      } );\n\n   eventBus.subscribe( 'didChangeAreaVisibility.' + context.widget.area, event => {\n      if( !visible && event.visible ) {\n         visible = true;\n         update();\n      }\n   } );\n\n   function renderEmpty() {\n      reactRender( <h3>Waiting for data</h3> );\n   }\n\n   let dispatcher;\n   function update() {\n      if( !visible || !domAvailable || !resourceAvailable ) {\n         return;\n      }\n\n      const pageInfo = context.resources.pageInfo;\n      const pageGraph = graph( pageInfo );\n      const pageTyeps = types();\n      const pageLayout = layout( pageGraph );\n      dispatcher = new Dispatcher( render );\n      new HistoryStore( dispatcher );\n      const graphStore = new GraphStore( dispatcher, pageGraph, pageTyeps );\n      const layoutStore = new LayoutStore( dispatcher, pageLayout, graphStore );\n      const settingsStore = new SettingsStore( dispatcher, Settings({ mode: READ_ONLY }) );\n      const selectionStore = new SelectionStore( dispatcher, layoutStore, graphStore );\n\n      window.setTimeout( () => { dispatcher.dispatch( AutoLayout() ); }, 0 );\n\n      function render() {\n         reactRender(\n            <div className='page-inspector-row'>\n               <h2><i className='fa fa-newspaper-o'></i>  { name }</h2>\n               <div className='demo-wrapper'>\n                 <div className='demo-editor'>\n                   <Graph className={'nbe-theme-fusebox-app'}\n                          types={graphStore.types}\n                          model={graphStore.graph}\n                          layout={layoutStore.layout}\n                          measurements={layoutStore.measurements}\n                          settings={settingsStore.settings}\n                          selection={selectionStore.selection}\n                          eventHandler={dispatcher.dispatch} />\n                 </div>\n               </div>\n            </div>\n         );\n      }\n   }\n\n   return { onDomAvailable: () => {\n      domAvailable = true;\n      update();\n   } };\n}\n\nexport default {\n   name: 'ax-page-inspector-widget',\n   injections: [ 'axContext', 'axEventBus', 'axReactRender' ],\n   create\n};\n"]}